\section{Method inputs}

There are three kinds of input to a method
\begin{itemize}
\item options
\item datasets
\item jobids
\end{itemize}

each vill be described in more detail next

\subsection*{options}
The options is of type dict.  Example

\begin{python}
from extras import OptionEnum, JobWithFile
options = dict(
  length = 1,
  colname = "gtin",
  operation = OptionEnum("lt le gt ge").ge,
  datafile = JobWithFile,
)
\end{python}
In the example above, the following happens
\begin{itemize}
\item length is typed to int, and default value is 1.
\item colname is typed to string, and default value is "gtin".
\item operation is one of lt, le, gt, ge, and defaults to ge.
\item datafile is more complex, for example datafile.jobid is a jobid,
  such as "pelle-123\_0", datafile.filename is a filename, such as
  "result.pickle", datafile.sliced is a boolean.  If true, the
  datafile is actually a sliced set of files, one for each target
  slice during execution, extra is what?
\end{itemize}

\subsubsection{types}
set, jobwithfile, datetime, date, time, timedelta




\subsubsection{JobWithFile}

jobid, sliced, filename, extra


\subsubsection{OptionDefault}
What?


\subsubsection{OptionString}
Marker value to specify in options\{\} for requiring a non-empty string.
You can use plain OptionString, or you can use
OptionString('example'), without making 'example' the default.
    

\subsubsection{OptionEnum}
From the source code

\begin{python}
    """A little like Enum in python34, but string-like.                                                                                                                                                                           
    (For JSONable method option enums.)                                                                                                                                                                                           
                                                                                                                                                                                                                                  
    >>> foo = OptionEnum('a b c*')                                                                                                                                                                                                
    >>> foo.a                                                                                                                                                                                                                     
    'a'                                                                                                                                                                                                                           
    >>> foo.a == 'a'                                                                                                                                                                                                              
    True                                                                                                                                                                                                                          
    >>> foo.a == foo['a']                                                                                                                                                                                                         
    True                                                                                                                                                                                                                          
    >>> isinstance(foo.a, OptionEnumValue)                                                                                                                                                                                        
    True                                                                                                                                                                                                                          
    >>> isinstance(foo['a'], OptionEnumValue)                                                                                                                                                                                     
    True                                                                                                                                                                                                                          
    >>> foo['cde'] == 'cde'                                                                                                                                                                                                       
    True                                                                                                                                                                                                                          
    >>> foo['abc']                                                                                                                                                                                                                
    Traceback (most recent call last):                                                                                                                                                                                            
    ...                                                                                                                                                                                                                           
    KeyError: 'abc'                                                                                                                                                                                                               
                                                                                                                                                                                                                                  
    Pass either foo (for a default of None) or one of the members                                                                                                                                                                 
    as the value in options{}. You get a string back, which compares                                                                                                                                                              
    equal to the member of the same name.                                                                                                                                                                                         
                                                                                                                                                                                                                                  
    Set none_ok if you accept None as the value.                                                                                                                                                                                  
                                                                                                                                                                                                                                  
    If a value ends in * that matches all endings. You can only access                                                                                                                                                            
    these as foo['cde'] (for use in options{}).                                                                                                                                                                                   
    """
\end{python}

\subsection{datasets}
datasets is the way to communicate datasets from automata to job.  In
the running method, the datasets variable is a list of dataset objects
ready to use.

\subsection{jobids}
the jobids argument is a tuple of jobids linking this job to other
jobs.  jobids is different from datasets in that jobids does not
contain any dataset jobs.  Thus, no dataset objects are infered from
the jobids in the tuple.



\section{Code flow:  prepare - analysis - synthesis}

\section{More on intermediate and result files}

\subsection{Sharing data inside a job}
data is simply shared between prepare, analysis, and synthesis as follows.
\begin{itemize}
\item what is returned in prepare is available as prepare\_res in analysis and synthesis
\item what is returned in analysis is available as analysis\_res in synthesis.  analysis\_res is an iterator.
\item what is returned in synthesis is a persistent file in the job catalog referenced by ``result''.
\end{itemize}

The simplest way to share intra job data is using the blob module.

\begin{python}
import blob
def synthesis()
  blob.load(filename')
\end{python}

saving is as follows
\begin{python}
  blob.save(data, filename, sliceno, temp)
\end{python}
sliceno and temp are optional.  If sliceno is set, data is stored in a
sliced file.  This is typically used in analysis, where each thread
will save its own file.

temp is used for file persistence.  By default, files are stored
permanently when a job terminates successfully.  Setting temp to True
removes them upon completion of the job.

Temporary files are useful when communicating data between the
functions in the method (and not using the res-files) or in debugging.

\section{debug help}
There is also a more advanced debug functionality relating to temp.

\begin{python}
from extras import Temp
def analysis(sliceno):
  ...
  blob.save(data, filename, sliceno=sliceno, temp=Temp.DEBUG)
  # or
  blob.save(data, filename, sliceno=sliceno, temp=Temp.DEBUGTEMP)
\end{python}
where the first only stores when --debug is specified, and the other
always stores but removes unless --debug is set.



\section{subjobs}
